"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9135],{76955:function(de,S,s){s.r(S);var H=s(15009),P=s.n(H),Q=s(97857),g=s.n(Q),Y=s(99289),D=s.n(Y),J=s(5574),U=s.n(J),T=s(56211),X=s(87547),M=s(94149),b=s(24454),k=s(68262),v=s(5966),u=s(35312),q=s(40056),B=s(2453),ee=s(11941),se=s(71230),C=s(15746),re=s(67610),R=s(67294),ae=s(73935),oe=s(6189),e=s(85893),ne=(0,oe.kc)(function(O){var f=O.token;return{action:{marginLeft:"8px",color:"rgba(0, 0, 0, 0.2)",fontSize:"24px",verticalAlign:"middle",cursor:"pointer",transition:"color 0.3s","&:hover":{color:f.colorPrimaryActive}},container:{display:"flex",flexDirection:"column",height:"100vh",overflow:"auto",backgroundImage:"url('https://mdn.alipayobjects.com/yuyan_qk0oxh/afts/img/V-_oS6r-i7wAAAAAAAAAAAAAFl94AQBr')",backgroundSize:"100% 100%"},main:{padding:"0px !important",margin:"10px"}}}),W=function(f){var x=f.content;return(0,e.jsx)(q.Z,{style:{marginBottom:24},message:x,type:"error",showIcon:!0})},te=function(){var f,x=(0,R.useState)({}),K=U()(x,2),Z=K[0],ce=K[1],le=(0,R.useState)("sign-in"),w=U()(le,2),j=w[0],ie=w[1],z=(0,u.useModel)("@@initialState"),n=z.initialState,F=z.setInitialState,_e=ne(),y=_e.styles,pe=(0,u.useIntl)(),me=function(){var E=D()(P()().mark(function i(){var r,_;return P()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("auth - fetchUserInfo"),t.next=3,n==null||(r=n.fetchUserInfo)===null||r===void 0?void 0:r.call(n);case 3:_=t.sent,console.log("auth - userInfo"),console.log(_),_?(console.log("auth - userInfo - case - 01"),(0,ae.flushSync)(function(){console.log("auth - userInfo - case - 02"),F(function(h){return g()(g()({},h),{},{currentUser:_})})})):console.log("auth - userInfo - case - 03"),console.log("auth - initialState"),console.log(n);case 9:case"end":return t.stop()}},i)}));return function(){return E.apply(this,arguments)}}(),ue=function(){var E=D()(P()().mark(function i(r){var _,o,t,h,l,A,I,d,c,p,m,V,L,G;return P()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(console.log("handleSubmit"),console.log("values"),console.log(r),a.prev=3,l="",!((r==null||(_=r.name)===null||_===void 0?void 0:_.length)>0)){a.next=16;break}return r.name=r.first_name+" "+r.last_name,r.role="user",a.next=10,(0,T.z2)(g()(g()({},r),{},{type:j}));case 10:A=a.sent,console.log("register_api_response"),console.log(A),l=A,a.next=22;break;case 16:return a.next=18,(0,T.x4)(g()(g()({},r),{},{type:j}));case 18:I=a.sent,console.log("login_api_response"),console.log(I),l=I;case 22:if(localStorage.setItem("laravel_api_bearer_token",(o=l)===null||o===void 0||(o=o.data)===null||o===void 0?void 0:o.access_token),console.log("after - redirect - logged_user_api_response?.data?.user"),console.log((t=l)===null||t===void 0||(t=t.data)===null||t===void 0?void 0:t.user),F(g()(g()({},n),{},{currentUser:(h=l)===null||h===void 0||(h=h.data)===null||h===void 0?void 0:h.user,refresh:function(){return!0}})),console.log("before - redirect - initialState"),console.log(n),l.status!==!0){a.next=41;break}return V="login successful!",B.ZP.success(V),L=new URL(window.location.href).searchParams,u.history.push(L.get("redirect")||"/"+((d=l)===null||d===void 0||(d=d.data)===null||d===void 0||(d=d.user)===null||d===void 0?void 0:d.role)+"-app/",{initialState:n}),u.history.replace(L.get("redirect")||"/"+((c=l)===null||c===void 0||(c=c.data)===null||c===void 0||(c=c.user)===null||c===void 0?void 0:c.role)+"-app/",{initialState:n}),u.history.push("/"+((p=l)===null||p===void 0||(p=p.data)===null||p===void 0||(p=p.user)===null||p===void 0?void 0:p.role)+"-app/"),u.history.replace("/"+((m=l)===null||m===void 0||(m=m.data)===null||m===void 0||(m=m.user)===null||m===void 0?void 0:m.role)+"-app/"),console.log("after - redirect - initialState"),console.log(n),a.abrupt("return");case 41:return u.history.push("/authentication"),u.history.replace("/authentication"),a.abrupt("return");case 44:a.next=51;break;case 46:a.prev=46,a.t0=a.catch(3),G="Login failed, please try again!",console.log(a.t0),B.ZP.error(G);case 51:case"end":return a.stop()}},i,null,[[3,46]])}));return function(r){return E.apply(this,arguments)}}(),$=Z.status,N=Z.type;return(0,e.jsxs)("div",{className:y==null?void 0:y.container,children:[(0,e.jsx)(u.Helmet,{children:(0,e.jsx)("title",{children:re.Z.title})}),(0,e.jsx)("div",{style:{flex:"1"},children:(0,e.jsxs)(k.U,{contentStyle:{minWidth:280,maxWidth:"75vw"},logo:(0,e.jsx)("img",{alt:"logo",src:n==null||(f=n.settings)===null||f===void 0?void 0:f.logo}),title:"TravelMates - 02",subTitle:"Your ultimate travel companion management app.",onFinish:function(){var E=D()(P()().mark(function i(r){return P()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,ue(r);case 2:case"end":return o.stop()}},i)}));return function(i){return E.apply(this,arguments)}}(),children:[(0,e.jsx)(ee.Z,{activeKey:j,onChange:ie,centered:!0,items:[{key:"sign-in",label:"Sign in"},{key:"sign-up",label:"Sign Up"}]}),$==="error"&&N==="sign-in"&&(0,e.jsx)(W,{content:"Wrong username or password"}),j==="sign-in"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(v.Z,{name:"email",fieldProps:{size:"large",prefix:(0,e.jsx)(X.Z,{})},placeholder:"username: admin or user",rules:[{required:!0,message:"please enter user name!"}]}),(0,e.jsx)(v.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,e.jsx)(M.Z,{}),max:10,min:6},placeholder:"password: ant.design",rules:[{required:!0,message:"Please enter your password!"}]})]}),$==="error"&&N==="sign-up"&&(0,e.jsx)(W,{content:"Verification code error"}),j==="sign-up"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(se.Z,{gutter:{xs:8,sm:16,md:24,lg:32},children:[(0,e.jsx)(C.Z,{span:12,children:(0,e.jsx)(v.Z,{name:"first_name",label:"First Name:",placeholder:"please enter your first name",rules:[{required:!0,message:"Please enter your first name!"}]})}),(0,e.jsx)(C.Z,{span:12,children:(0,e.jsx)(v.Z,{name:"last_name",label:"Last Name:",placeholder:"please enter your last name",rules:[{required:!0,message:"Please enter your last name!"}]})})]}),(0,e.jsx)(v.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(b.Z,{})},name:"name",placeholder:"Name",rules:[{required:!0,message:"Please enter name!"}]}),(0,e.jsx)(v.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(b.Z,{})},name:"email",placeholder:"Email",rules:[{required:!0,message:"Please enter email!"}]}),(0,e.jsx)(v.Z.Password,{fieldProps:{size:"large",prefix:(0,e.jsx)(M.Z,{}),max:10,min:6},name:"password",placeholder:"Password",rules:[{required:!0,message:"Please enter password!"}]}),(0,e.jsx)(v.Z.Password,{name:"password_confirmation",dependencies:["password"],fieldProps:{size:"large",prefix:(0,e.jsx)(M.Z,{}),max:10,min:6},placeholder:"password: ant.design",rules:[{required:!0,message:"Please confirm your password!"},function(E){var i=E.getFieldValue;return{validator:function(_,o){return!o||i("password")===o?Promise.resolve():Promise.reject(new Error("The new password that you entered do not match!"))}}}]})]}),(0,e.jsx)("div",{style:{marginBottom:24}})]})})]})};S.default=te}}]);
